<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
    integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous" />
  <title>Document</title>
</head>

<body>
  <div class="container">

    <div style="margin-top: 30px">
      <button class="btn btn-info btn-block" id="getBooks" onclick="getBooks()">
        Get all books
      </button>
    </div>

    <!-- FORM -->
    <div id="forms">
      <div style="margin-top: 20px">
        <h3 style="text-align: center;">New Book</h3>
        <div class="form-group">
          <input type="number" class="form-control" id="isbn1" placeholder="Enter book ISBN">
        </div>
        <div class="form-group">
          <input type="text" class="form-control" id="title1" placeholder="Enter book Title">
        </div>
        <div class="form-group">
          <input type="text" class="form-control" id="author1" placeholder="Enter book Author">
        </div>
        <div class="form-group">
          <input type="text" class="form-control" id="year1" placeholder="Enter book Year">
        </div>
      </div>
    </div>

    <!-- CREATE A BOOK BUTTON -->
    <div style="margin-top: 30px">
      <button class="btn btn-success btn-block" id="submitBook" onclick="createNewBook()">
        Create a Book
      </button>
    </div>

    <hr>

    <div style="margin-top: 20px">
      <h3 style="text-align: center;">Book by author</h3>
      <div class="form-group">
        <input type="text" class="form-control" id="searchByAuthor" placeholder="Enter author name">
      </div>
    </div>
    <div style="margin-top: 10px">
      <button class="btn btn-info btn-block" id="getBooksByAuthor" onclick="getBooksByAuthor()">
        Get books created by author
      </button>
    </div>

    <hr>

    <div style="margin-top: 20px">
      <h3 style="text-align: center;">Delete book by ISBN</h3>
      <div class="form-group">
        <input type="text" class="form-control" id="isbnToDelete" placeholder="Enter book ISBN">
      </div>
    </div>
    <div style="margin-top: 10px">
      <button class="btn btn-danger btn-block" id="delete" onclick="deleteBook()">
        Delete book
      </button>
    </div>

  </div>

  <script>

    function getBooks() {
      fetch("http://localhost:3001/get-all-books")
        .then(res => res.json())
        .then(data => console.log(data))
    }

    function getBooksByAuthor() {
      let author = document.getElementById("searchByAuthor");
      if (author.value) {
        fetch("http://localhost:3001/get-books-by-author/" + author.value)
          .then(res => res.json())
          .then(data => console.log(data))
      } else {
        console.error('Please enter an author!')
      }
    }

    function createNewBook() {
      const data = {
        isbn: document.getElementById("isbn1").value,
        title: document.getElementById("title1").value,
        author: document.getElementById("author1").value,
        year: document.getElementById("year1").value
      };

      if (!data.isbn || !data.title || !data.author || !data.year) {
        console.log('Please fill out all required data!')
      } else {
          fetch("http://localhost:3001/add-book", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(data)
        })
          .then(res => res.json())
          .then(data => {
            console.log(data);
            if (data === "Successfully added a new book") {
              document.getElementById("isbn1").value = "";
              document.getElementById("title1").value = "";
              document.getElementById("author1").value = "";
              document.getElementById("year1").value = "";
            }

          });
      }
    }

    function deleteBook() {
      fetch(`http://localhost:3001/remove-book/${document.getElementById('isbnToDelete').value}`, {
        method: 'delete',
      })
        .then(response => response.json())
        .then(json => console.log(json))
    }
  </script>
</body>

</html>